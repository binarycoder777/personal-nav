---
import { Icon } from "astro-icon/components";
---

<div class="fixed top-0 right-0 left-0 z-30 bg-white">
  <div class="flex items-center justify-between py-4 px-6 border-b border-gray-100" id="topbar">
    {/* 左侧 Logo 和站点名 */}
    <div class="flex items-center space-x-3 ml-[100px]">
      <div class="flex items-center space-x-3 group">
        <img src="/logo.jpg" alt="Logo" class="w-8 h-8 transition-transform duration-300 group-hover:scale-105" />
        <span class="text-xl font-semibold bg-gradient-to-r from-purple-600 to-blue-500 bg-clip-text text-transparent">
          CodeAtlas
        </span>
      </div>
    </div>

    {/* 右侧导航和功能区 */}
    <div class="flex items-center">
      {/* 主导航链接 */}
      <nav class="flex items-center space-x-8 mr-8 text-gray-600">
        <a href="https://binarycoder777.cn" class="hover:text-purple-600 transition-colors duration-200 flex items-center space-x-1">
          <Icon name="lucide:book-open" class="w-4 h-4" />
          <span>博客</span>
        </a>
        <a href="https://binarycoder777.com" class="hover:text-purple-600 transition-colors duration-200 flex items-center space-x-1">
          <Icon name="lucide:file-text" class="w-4 h-4" />
          <span>周刊</span>
        </a>
        <button 
          id="contribute-btn"
          class="hover:text-purple-600 transition-colors duration-200 flex items-center space-x-1"
        >
          <Icon name="lucide:edit-3" class="w-4 h-4" />
          <span>投稿</span>
        </button>
      </nav>

      {/* 分隔线 */}
      <div class="h-6 w-px bg-gray-200 mx-4"></div>

      {/* 社交链接和主题切换 */}
      <div class="flex items-center space-x-4">
        <a 
          href="https://github.com/yourusername" 
          target="_blank" 
          rel="noopener noreferrer"
          class="text-gray-600 hover:text-gray-900 transition-colors duration-200"
        >
          <Icon name="lucide:github" class="w-5 h-5" />
        </a>
        <a 
          href="https://x.com/binarycoder777" 
          target="_blank" 
          rel="noopener noreferrer"
          class="text-gray-600 hover:text-gray-900 transition-colors duration-200"
        >
          <Icon name="lucide:twitter" class="w-5 h-5" />
        </a>
        
      </div>
    </div>
  </div>
</div>

<!-- 投稿弹窗 -->
<div id="contribute-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
  <div class="bg-white rounded-xl shadow-xl w-full max-w-lg mx-4 transform transition-all">
    <!-- 弹窗头部 -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100">
      <h3 class="text-xl font-semibold text-gray-900">提交工具</h3>
      <button id="close-modal" class="text-gray-400 hover:text-gray-500 transition-colors">
        <Icon name="lucide:x" class="w-5 h-5" />
      </button>
    </div>
    
    <!-- 弹窗内容 -->
    <div class="px-6 py-4">
      <form id="contribute-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">工具名称</label>
          <input 
            type="text" 
            name="title" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            placeholder="请输入工具名称"
          />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">工具链接</label>
          <input 
            type="url" 
            name="url" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            placeholder="请输入工具链接"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">工具分类</label>
          <select 
            name="category" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
          >
            <option value="">请选择分类</option>
            <option value="AI">AI</option>
            <option value="开发工具">开发工具</option>
            <option value="文本处理">文本处理</option>
            <option value="视频处理">视频处理</option>
            <option value="设计">设计</option>
            <option value="社区">社区</option>
            <option value="灵感">灵感</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">工具描述</label>
          <textarea 
            name="description" 
            required
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            placeholder="请简要描述工具的主要功能和特点"
          ></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">标签</label>
          <input 
            type="text" 
            name="tag" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            placeholder="请输入标签，多个标签用逗号分隔"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">工具图标或截图</label>
          <input 
            type="url" 
            name="image" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            placeholder="请输入图片链接"
          />
        </div>
      </form>
    </div>
    
    <!-- 弹窗底部 -->
    <div class="flex justify-end space-x-3 px-6 py-4 border-t border-gray-100">
      <button 
        id="cancel-btn"
        class="px-4 py-2 text-gray-700 hover:text-gray-900 transition-colors"
      >
        取消
      </button>
      <button 
        id="submit-btn"
        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
      >
        提交
      </button>
    </div>
  </div>
</div>

<script>
  import { submitContribute } from '../services/contributeService.js';

  // 主题切换功能
  const themeToggle = document.getElementById('theme-toggle');
  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  }

  // 初始化主题
  const theme = localStorage.getItem('theme') || 'light';
  if (theme === 'dark') {
    document.documentElement.classList.add('dark');
  }

  // 投稿弹窗相关
  const modal = document.getElementById('contribute-modal');
  const contributeBtn = document.getElementById('contribute-btn');
  const closeBtn = document.getElementById('close-modal');
  const cancelBtn = document.getElementById('cancel-btn');
  const submitBtn = document.getElementById('submit-btn');
  const contributeForm = document.getElementById('contribute-form');

  // 打开弹窗
  contributeBtn?.addEventListener('click', () => {
    modal?.classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // 防止背景滚动
  });

  // 关闭弹窗函数
  function closeModal() {
    modal?.classList.add('hidden');
    document.body.style.overflow = '';
    contributeForm?.reset(); // 重置表单
  }

  // 关闭弹窗的几种方式
  closeBtn?.addEventListener('click', closeModal);
  cancelBtn?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal();
    }
  });

  // ESC 键关闭弹窗
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
      closeModal();
    }
  });

  // 提交表单
  submitBtn?.addEventListener('click', async () => {
    if (!contributeForm) return;
    
    const formData = new FormData(contributeForm);
    
    try {
      await submitContribute({
        name: formData.get('title'),
        url: formData.get('url'),
        category: formData.get('category'),
        description: formData.get('description'),
        tag: formData.get('tag'),
        image: formData.get('image')
      });

      alert('提交成功！感谢您的投稿，我们会尽快审核。');
      closeModal();
      contributeForm.reset();
    } catch (error) {
      console.error('Submit error:', error);
      alert('提交失败，请稍后重试');
    }
  });
</script>

<style>
  /* 添加悬停动画效果 */
  nav a {
    position: relative;
  }

  nav a::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -2px;
    left: 0;
    background: linear-gradient(to right, #9333ea, #3b82f6);
    transition: width 0.3s ease;
  }

  nav a:hover::after {
    width: 100%;
  }

  /* 弹窗动画 */
  #contribute-modal {
    transition: opacity 0.3s ease;
  }

  #contribute-modal > div {
    transition: transform 0.3s ease;
  }

  #contribute-modal.hidden > div {
    transform: scale(0.95);
  }
</style> 